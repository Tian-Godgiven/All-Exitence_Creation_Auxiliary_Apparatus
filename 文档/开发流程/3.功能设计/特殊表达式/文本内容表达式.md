[toc]

# 文本内容表达式

本软件提供了在文本内容插入事物响应块的功能，这些响应块本质上是绑定了点击事件的div对象（以下简称跳转div）这些div数据需要保存在文件中，并在读取时重新加载

借此可将文本内容分为两个类型：字符串与跳转div，这两种类型的元素会按情况存放在数组中。文本内容的表达式主要就是对这个数组在不同状态间进行翻译，这些状态包括：文件，前端内容和txt文本内容，在这个过程中，最重要的就是对跳转div的转换

**文件状态**：JSON格式的文本内容对象，在其中仅包含单个字符串时为字符串，否则为上述结构的数组  
**前端内容**：dom元素组成的数组，字符串被翻译为text元素，跳转div由对象翻译为实际的dom结构，需要注意换行会被翻译为`<br>`元素
**txt内容**：提取跳转div的内容，并将数组中的元素组合成一个字符串的形式

# 跳转div

一个具备类`.jumpDiv`，会触发全局监听点击跳转事件的div，其有着独特设置的样式，且无法被编辑，尽管叫他跳转div，但其均为span标签

源文件：`@\hooks\inputSupport\inputSuggestion\jumpDiv.ts`

## 结构

跳转内容为如下所示的对象

```
{
	type:string,//跳转类型
	target:any//跳转目标
	info?:"nickName"//跳转div信息，目前仅用于提示该div存储事物别名
	text?:string,//暂存跳转div内部显示的内容
}
```

在加载文件时，上述内容会被翻译为一个跳转div并嵌套进对应的位置，翻译步骤详见下方
在保存文件时，跳转div则会被翻译为上述对象
在导出为txt时，只会保留跳转div的inner部分

### 构建跳转div

构建跳转div的同时，都会以弱引用(weakmap)的方式在全局变量 divWeakmap（from cursorAbility.ts）内存储`{type,target,info,text}`，含义如下

| type     | target的对应含义                                             |
| -------- | ------------------------------------------------------------ |
| exitence | 数组：[该事物对象所在的分类的\_\_key，该事物对象的\_\_key值] |
|          |                                                              |
|          |                                                              |



由于是弱引用，当该跳转div卸载时，相应的数据也会销毁，知道下一次构建该跳转div

翻译跳转div时，使用`target`的内容，根据`type`的类型获取跳转div显示的内容

#### 1.exitence类型

通过`target`寻找该事物所在的`type`再在`type`中寻找事物对象本身，若没能找到则会返回`false`，并不会构建相应的跳转div

获取到事物对象后，查看其设置`setting`，若其设置项`autoCompleteText`存在且非空，则其显示内容为该该设置项的值

查看其设置项`autoCompleteNickName`存在且为`true`，则尝试获取文件数据中的`text`
若`text`存在则进一步查看该`text`内容是否为该事物的设置项`nickName`对应的属性中的一部分，若是则显示内容为该`text`的值  
以上任意为否时，显示内容为该事物的name

若上述两个设置项均无效，则显示内容为该事物的name

## 翻译跳转div
